---
// src/pages/reservas.astro - Refactorizada
import Layout from '../layouts/Layout.astro';
import HeroSection from '../components/shared/HeroSection.astro';
import MessageAlert from '../components/shared/MessageAlert.astro';
import Card from '../components/ui/Card.astro';
---

<Layout 
  title="Reservas - Restaurante La Deliciosa | Reserva tu Mesa Online"
  description="Reserva tu mesa en Restaurante La Deliciosa de forma fácil y rápida. Disponibilidad inmediata, confirmación instantánea. Cenas familiares, románticas o de negocios."
  keywords="reservar mesa, reservas online, restaurante Tegucigalpa, cena romántica, evento familiar"
>
  <!-- Hero Section -->
  <HeroSection
    title="Reserva tu Mesa"
    subtitle="Asegura tu lugar en La Deliciosa y vive una experiencia gastronómica inolvidable"
    variant="gradient"
    backgroundColor="bg-gradient-to-r from-gray-900 to-gray-800"
    size="md"
  />

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-12">
      
      <!-- Reservation Form -->
      <div class="lg:col-span-2">
        <Card variant="shadow" padding="lg">
          <h2 class="font-display text-2xl font-bold text-gray-900 mb-6">
            Información de Reserva
          </h2>
          
          <form id="reservationForm" class="space-y-6">
            <!-- Personal Information -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
              <div>
                <label for="firstName" class="block text-sm font-medium text-gray-700 mb-2">
                  Nombre *
                </label>
                <input 
                  type="text" 
                  id="firstName" 
                  name="firstName" 
                  required
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-colors"
                  placeholder="Tu nombre"
                />
              </div>
              
              <div>
                <label for="lastName" class="block text-sm font-medium text-gray-700 mb-2">
                  Apellido *
                </label>
                <input 
                  type="text" 
                  id="lastName" 
                  name="lastName" 
                  required
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-colors"
                  placeholder="Tu apellido"
                />
              </div>
            </div>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
              <div>
                <label for="email" class="block text-sm font-medium text-gray-700 mb-2">
                  Correo Electrónico *
                </label>
                <input 
                  type="email" 
                  id="email" 
                  name="email" 
                  required
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-colors"
                  placeholder="tu@email.com"
                />
              </div>
              
              <div>
                <label for="phone" class="block text-sm font-medium text-gray-700 mb-2">
                  Teléfono *
                </label>
                <input 
                  type="tel" 
                  id="phone" 
                  name="phone" 
                  required
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-colors"
                  placeholder="+504 0000-0000"
                />
              </div>
            </div>
            
            <!-- Reservation Details -->
            <div class="border-t border-gray-200 pt-6">
              <h3 class="font-semibold text-gray-900 mb-4">Detalles de la Reserva</h3>
              
              <div class="grid grid-cols-1 sm:grid-cols-3 gap-6">
                <div>
                  <label for="date" class="block text-sm font-medium text-gray-700 mb-2">
                    Fecha *
                  </label>
                  <input 
                    type="date" 
                    id="date" 
                    name="date" 
                    required
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-colors"
                  />
                </div>
                
                <div>
                  <label for="time" class="block text-sm font-medium text-gray-700 mb-2">
                    Hora *
                  </label>
                  <select 
                    id="time" 
                    name="time" 
                    required
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-colors"
                  >
                    <option value="">Seleccionar hora</option>
                    <option value="11:00">11:00 AM</option>
                    <option value="11:30">11:30 AM</option>
                    <option value="12:00">12:00 PM</option>
                    <option value="12:30">12:30 PM</option>
                    <option value="13:00">1:00 PM</option>
                    <option value="13:30">1:30 PM</option>
                    <option value="14:00">2:00 PM</option>
                    <option value="18:00">6:00 PM</option>
                    <option value="18:30">6:30 PM</option>
                    <option value="19:00">7:00 PM</option>
                    <option value="19:30">7:30 PM</option>
                    <option value="20:00">8:00 PM</option>
                    <option value="20:30">8:30 PM</option>
                    <option value="21:00">9:00 PM</option>
                  </select>
                </div>
                
                <div>
                  <label for="guests" class="block text-sm font-medium text-gray-700 mb-2">
                    Personas *
                  </label>
                  <select 
                    id="guests" 
                    name="guests" 
                    required
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-colors"
                  >
                    <option value="">Número de personas</option>
                    <option value="1">1 persona</option>
                    <option value="2">2 personas</option>
                    <option value="3">3 personas</option>
                    <option value="4">4 personas</option>
                    <option value="5">5 personas</option>
                    <option value="6">6 personas</option>
                    <option value="8">8 personas</option>
                    <option value="9+">9+ personas</option>
                  </select>
                </div>
              </div>
            </div>
            
            <!-- Special Preferences -->
            <div>
              <label for="occasion" class="block text-sm font-medium text-gray-700 mb-2">
                Ocasión Especial
              </label>
              <select 
                id="occasion" 
                name="occasion"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-colors"
              >
                <option value="">Seleccionar ocasión (opcional)</option>
                <option value="birthday">Cumpleaños</option>
                <option value="anniversary">Aniversario</option>
                <option value="date">Cita romántica</option>
                <option value="business">Cena de negocios</option>
                <option value="celebration">Celebración</option>
                <option value="other">Otra</option>
              </select>
            </div>
            
            <div>
              <label for="preferences" class="block text-sm font-medium text-gray-700 mb-2">
                Preferencias Especiales
              </label>
              <textarea 
                id="preferences" 
                name="preferences" 
                rows="3"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-colors resize-none"
                placeholder="Alergias alimentarias, preferencias de mesa, solicitudes especiales..."
              ></textarea>
            </div>
            
            <!-- Terms and Conditions -->
            <div class="flex items-start space-x-3">
              <input 
                type="checkbox" 
                id="terms" 
                name="terms" 
                required
                class="mt-1 h-4 w-4 text-amber-600 focus:ring-amber-500 border-gray-300 rounded"
              />
              <label for="terms" class="text-sm text-gray-700">
                Acepto los <a href="#" class="text-amber-600 hover:text-amber-700 underline">términos y condiciones</a> 
                y la <a href="#" class="text-amber-600 hover:text-amber-700 underline">política de cancelación</a> *
              </label>
            </div>
            
            <button 
              type="submit" 
              class="w-full bg-amber-600 hover:bg-amber-700 text-white py-4 px-6 rounded-lg font-semibold text-lg transition-all duration-300 transform hover:scale-105"
            >
              Confirmar Reserva
            </button>
          </form>
          
          <!-- Success/Error Messages -->
          <div id="reservationMessage" class="mt-6 hidden">
            <div id="successReservation" class="hidden">
              <MessageAlert 
                id="reservationSuccess"
                variant="success" 
                title="¡Reserva Confirmada!" 
                message="Hemos recibido tu reserva exitosamente. Te contactaremos pronto para confirmar los detalles."
              />
            </div>
            <div id="errorReservation" class="hidden">
              <MessageAlert 
                id="reservationError"
                variant="error" 
                title="Error en la Reserva" 
                message="Lo sentimos, hubo un problema al procesar tu reserva. Por favor intenta nuevamente o contáctanos directamente."
              />
            </div>
          </div>
        </Card>
      </div>
      
      <!-- Sidebar Information -->
      <div class="space-y-6">
        
        <!-- Contact Info -->
        <Card variant="default" class="bg-amber-50">
          <h3 class="font-display text-xl font-bold text-gray-900 mb-4">
            Información Importante
          </h3>
          
          <div class="space-y-4 text-sm text-gray-700">
            <div class="flex items-start space-x-3">
              <svg class="w-5 h-5 text-amber-600 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <div>
                <p class="font-medium">Política de Cancelación</p>
                <p>Puedes cancelar hasta 2 horas antes de tu reserva sin costo.</p>
              </div>
            </div>
            
            <div class="flex items-start space-x-3">
              <svg class="w-5 h-5 text-amber-600 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
              </svg>
              <div>
                <p class="font-medium">Grupos Grandes</p>
                <p>Para grupos de 9+ personas, contáctanos directamente para mejor atención.</p>
              </div>
            </div>
            
            <div class="flex items-start space-x-3">
              <svg class="w-5 h-5 text-amber-600 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <div>
                <p class="font-medium">Confirmación</p>
                <p>Recibirás confirmación por email y SMS dentro de las próximas 2 horas.</p>
              </div>
            </div>
          </div>
        </Card>
        
        <!-- Direct Contact -->
        <Card variant="shadow">
          <h3 class="font-display text-xl font-bold text-gray-900 mb-4">
            ¿Prefieres Llamar?
          </h3>
          
          <div class="space-y-4">
            <p class="text-gray-600 mb-4">
              Para reservas inmediatas o consultas especiales, contáctanos directamente:
            </p>
            
            <div class="space-y-3">
              <a 
                href="tel:+50422345678" 
                class="block w-full bg-amber-600 hover:bg-amber-700 text-white text-center py-3 px-4 rounded-lg font-semibold transition-colors"
              >
                📞 +504 2234-5678
              </a>
              
              <a 
                href="https://wa.me/50498765432" 
                target="_blank"
                rel="noopener noreferrer"
                class="block w-full bg-green-600 hover:bg-green-700 text-white text-center py-3 px-4 rounded-lg font-semibold transition-colors"
              >
                💬 WhatsApp
              </a>
            </div>
          </div>
        </Card>
        
        <!-- Opening Hours -->
        <Card variant="default">
          <h3 class="font-display text-xl font-bold text-gray-900 mb-4">
            Horarios de Atención
          </h3>
          
          <div class="space-y-3 text-sm">
            <div class="flex justify-between">
              <span class="font-medium">Lunes - Jueves</span>
              <span>11:00 AM - 9:00 PM</span>
            </div>
            <div class="flex justify-between">
              <span class="font-medium">Viernes - Sábado</span>
              <span>11:00 AM - 10:00 PM</span>
            </div>
            <div class="flex justify-between">
              <span class="font-medium">Domingo</span>
              <span>12:00 PM - 8:00 PM</span>
            </div>
          </div>
        </Card>
      </div>
    </div>
  </div>
</Layout>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Set minimum date to today
    const dateInput = document.getElementById('date') as HTMLInputElement;
    if (dateInput) {
      const today = new Date().toISOString().split('T')[0];
      dateInput.min = today;
      dateInput.value = today;
    }
    
    // Phone number formatting
    const phoneInput = document.getElementById('phone') as HTMLInputElement;
    if (phoneInput) {
      phoneInput.addEventListener('input', function(this: HTMLInputElement, e: Event) {
        let value = this.value.replace(/\D/g, '');
        if (value.startsWith('504')) {
          value = value.substring(3);
        }
        if (value.length >= 4) {
          value = value.substring(0, 4) + '-' + value.substring(4, 8);
        }
        if (value) {
          this.value = '+504 ' + value;
        }
      });
    }
    
    // Form submission
    const reservationForm = document.getElementById('reservationForm') as HTMLFormElement;
    if (reservationForm) {
      reservationForm.addEventListener('submit', async function(this: HTMLFormElement, e: Event) {
        e.preventDefault();
        
        const reservationMessage = document.getElementById('reservationMessage') as HTMLElement;
        const successMessage = document.getElementById('successReservation') as HTMLElement;
        const errorMessage = document.getElementById('errorReservation') as HTMLElement;
        
        // Show loading state
        const submitButton = this.querySelector('button[type="submit"]') as HTMLButtonElement;
        if (!submitButton) return;
        
        const originalText = submitButton.textContent || 'Confirmar Reserva';
        submitButton.textContent = 'Procesando Reserva...';
        submitButton.disabled = true;
        
        try {
          // Simulate API call
          await new Promise(resolve => setTimeout(resolve, 2000));
          
          // Show success message
          if (reservationMessage && successMessage && errorMessage) {
            reservationMessage.classList.remove('hidden');
            successMessage.classList.remove('hidden');
            errorMessage.classList.add('hidden');
          }
          
          // Reset form
          this.reset();
          
          // Reset date to today
          if (dateInput) {
            dateInput.value = new Date().toISOString().split('T')[0];
          }
          
          // Scroll to message
          if (reservationMessage) {
            reservationMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
          }
          
        } catch (error) {
          // Show error message
          if (reservationMessage && successMessage && errorMessage) {
            reservationMessage.classList.remove('hidden');
            errorMessage.classList.remove('hidden');
            successMessage.classList.add('hidden');
          }
          
        } finally {
          // Reset button
          submitButton.textContent = originalText;
          submitButton.disabled = false;
        }
      });
    }
    
    // Form validation enhancements
    const requiredInputs = document.querySelectorAll('input[required], select[required]');
    requiredInputs.forEach(input => {
      const inputElement = input as HTMLInputElement | HTMLSelectElement;
      
      inputElement.addEventListener('blur', function(this: HTMLInputElement | HTMLSelectElement) {
        if (!this.value.trim()) {
          this.classList.add('border-red-300');
          this.classList.remove('border-gray-300');
        } else {
          this.classList.remove('border-red-300');
          this.classList.add('border-gray-300');
        }
      });
      
      inputElement.addEventListener('input', function(this: HTMLInputElement | HTMLSelectElement) {
        if (this.value.trim()) {
          this.classList.remove('border-red-300');
          this.classList.add('border-gray-300');
        }
      });
    });
  });